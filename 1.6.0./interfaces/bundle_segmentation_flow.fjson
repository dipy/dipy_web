{"parents": [{"link": "../../documentation/", "title": "Documentation"}, {"link": "../", "title": "DIPY Workflows Interfaces"}], "prev": {"link": "../buan_flow/", "title": "BUndle ANalytics (BUAN) framework"}, "next": {"link": "../../faq/", "title": "Frequently Asked Questions"}, "title": "White Matter Bundle Segmentation with RecoBundles", "meta": {}, "body": "<section id=\"white-matter-bundle-segmentation-with-recobundles\">\n<span id=\"bundle-segmentation-flow\"></span><h1>White Matter Bundle Segmentation with RecoBundles<a class=\"headerlink\" href=\"#white-matter-bundle-segmentation-with-recobundles\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p>This tutorial explains how we can use RecoBundles <a class=\"reference internal\" href=\"../../reference_cmd/dipy_slr/#garyfallidis17\" id=\"id1\"><span>[Garyfallidis17]</span></a> to extract\nbundles from input tractograms.</p>\n<p>First, we need to download a reference streamline atlas. Here, we downloaded an atlas with\n30 bundles in MNI space <a class=\"reference internal\" href=\"#yeh18\" id=\"id2\"><span>[Yeh18]</span></a> from:</p>\n<blockquote>\n<div><p><a class=\"reference external\" href=\"https://figshare.com/articles/Atlas_of_30_Human_Brain_Bundles_in_MNI_space/12089652\">https://figshare.com/articles/Atlas_of_30_Human_Brain_Bundles_in_MNI_space/12089652</a></p>\n</div></blockquote>\n<p>For this tutorial, you can use your own tractography data or you can download a single subject\ntractogram from:</p>\n<blockquote>\n<div><p><a class=\"reference external\" href=\"https://figshare.com/articles/hcp_tractogram_zip/7013003\">https://figshare.com/articles/hcp_tractogram_zip/7013003</a></p>\n</div></blockquote>\n<p>Let\u2019s say we have an input target tractogram named <code class=\"docutils literal notranslate\"><span class=\"pre\">streamlines.trk</span></code> and the atlas we\ndownloaded, named <code class=\"docutils literal notranslate\"><span class=\"pre\">whole_brain_MNI.trk</span></code>.</p>\n<p>Visualizing the target and atlas tractograms before registration:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_horizon</span> <span class=\"s2\">&quot;streamlines.trk&quot;</span> <span class=\"s2\">&quot;whole_brain_MNI.trk&quot;</span> <span class=\"o\">--</span><span class=\"n\">random_color</span>\n</pre></div>\n</div>\n<figure class=\"align-center\" id=\"id5\">\n<a class=\"reference internal image-reference\" href=\"https://github.com/dipy/dipy_data/blob/master/tractograms_initial.png?raw=true\"><img alt=\"alternate text\" src=\"https://github.com/dipy/dipy_data/blob/master/tractograms_initial.png?raw=true\" style=\"width: 70%;\" /></a>\n<figcaption>\n<p><span class=\"caption-text\">Atlas and target tractograms before registration.</span><a class=\"headerlink\" href=\"#id5\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<section id=\"streamline-based-linear-registration\">\n<h2>Streamline-Based Linear Registration<a class=\"headerlink\" href=\"#streamline-based-linear-registration\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>To extract the bundles from the tractogram, we first need move our target tractogram to\nbe in the same space as the atlas (MNI, in this case). We can directly register the target tractogram to\nthe space of the atlas, using streamline-based linear registration (SLR) <a class=\"reference internal\" href=\"../../reference_cmd/dipy_slr/#garyfallidis15\" id=\"id3\"><span>[Garyfallidis15]</span></a>.</p>\n<p>The following workflows require two positional input arguments; <code class=\"docutils literal notranslate\"><span class=\"pre\">static</span></code> and\n<code class=\"docutils literal notranslate\"><span class=\"pre\">moving</span></code> .trk files. In our case, the <code class=\"docutils literal notranslate\"><span class=\"pre\">static</span></code> input is the atlas and the <code class=\"docutils literal notranslate\"><span class=\"pre\">moving</span></code> is\nour <code class=\"docutils literal notranslate\"><span class=\"pre\">target</span></code>  tractogram (<code class=\"docutils literal notranslate\"><span class=\"pre\">streamlines.trk</span></code>).</p>\n<p>Run the following workflow:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_slr</span> <span class=\"s2\">&quot;whole_brain_MNI.trk&quot;</span> <span class=\"s2\">&quot;streamlines.trk&quot;</span> <span class=\"o\">--</span><span class=\"n\">force</span>\n</pre></div>\n</div>\n<p>Per default, the SLR workflow will save a transformed tractogram as <code class=\"docutils literal notranslate\"><span class=\"pre\">moved.trk</span></code>.</p>\n<p>Visualizing the target and atlas tractograms after registration:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_horizon</span> <span class=\"s2\">&quot;moved.trk&quot;</span> <span class=\"s2\">&quot;whole_brain_MNI.trk&quot;</span> <span class=\"o\">--</span><span class=\"n\">random_color</span>\n</pre></div>\n</div>\n<figure class=\"align-center\" id=\"id6\">\n<a class=\"reference internal image-reference\" href=\"https://github.com/dipy/dipy_data/blob/master/tractograms_after_registration.png?raw=true\"><img alt=\"alternate text\" src=\"https://github.com/dipy/dipy_data/blob/master/tractograms_after_registration.png?raw=true\" style=\"width: 70%;\" /></a>\n<figcaption>\n<p><span class=\"caption-text\">Atlas and target tractograms after registration.</span><a class=\"headerlink\" href=\"#id6\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n</section>\n<section id=\"recobundles\">\n<h2>RecoBundles<a class=\"headerlink\" href=\"#recobundles\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>Create an <code class=\"docutils literal notranslate\"><span class=\"pre\">out_dir</span></code> folder (e.g., <code class=\"docutils literal notranslate\"><span class=\"pre\">rb_output</span></code>), into which output will be placed:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">rb_output</span>\n</pre></div>\n</div>\n<p>For the RecoBundles workflow, we will use the 30 model bundles downloaded earlier.\nRun the following workflow:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_recobundles</span> <span class=\"s2\">&quot;moved.trk&quot;</span> <span class=\"s2\">&quot;bundles/*.trk&quot;</span> <span class=\"o\">--</span><span class=\"n\">force</span> <span class=\"o\">--</span><span class=\"n\">mix_names</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;rb_output&quot;</span>\n</pre></div>\n</div>\n<p>This workflow will extract 30 bundles from the tractogram.\nExample of extracted Left Arcuate fasciculus (AF_L) bundle (visualized with <code class=\"docutils literal notranslate\"><span class=\"pre\">dipy_horizon</span></code>):</p>\n<figure class=\"align-center\" id=\"id7\">\n<a class=\"reference internal image-reference\" href=\"https://github.com/dipy/dipy_data/blob/master/AF_L_rb.png?raw=true\"><img alt=\"alternate text\" src=\"https://github.com/dipy/dipy_data/blob/master/AF_L_rb.png?raw=true\" style=\"width: 70%;\" /></a>\n<figcaption>\n<p><span class=\"caption-text\">Extracted Left Arcuate fasciculus (AF_L) from input tractogram</span><a class=\"headerlink\" href=\"#id7\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Example of extracted Left Arcuate fasciculus (AF_L) bundle visualized along\nwith the model AF_L bundle used as reference in RecoBundles:</p>\n<figure class=\"align-center\" id=\"id8\">\n<a class=\"reference internal image-reference\" href=\"https://github.com/dipy/dipy_data/blob/master/AF_L_rb_with_model.png?raw=true\"><img alt=\"alternate text\" src=\"https://github.com/dipy/dipy_data/blob/master/AF_L_rb_with_model.png?raw=true\" style=\"width: 70%;\" /></a>\n<figcaption>\n<p><span class=\"caption-text\">Extracted Left Arcuate fasciculus (AF_L) in pink and model AF_L bundle in green color.</span><a class=\"headerlink\" href=\"#id8\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Output of RecoBundles will be in native space. To get bundles in subject\u2019s\noriginal space, run following commands:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">org_output</span>\n\n<span class=\"n\">dipy_labelsbundles</span> <span class=\"s1\">&#39;streamlines.trk&#39;</span> <span class=\"s1\">&#39;rb_output/*.npy&#39;</span> <span class=\"o\">--</span><span class=\"n\">mix_names</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;org_output&quot;</span>\n</pre></div>\n</div>\n<p>For more information about each command line, please visit DIPY website <a class=\"reference external\" href=\"https://dipy.org/\">https://dipy.org/</a> .</p>\n<p>If you are using any of these commands please be sure to cite the relevant papers and\nDIPY <a class=\"reference internal\" href=\"../../reference_cmd/dipy_slr/#garyfallidis14\" id=\"id4\"><span>[Garyfallidis14]</span></a>.</p>\n</section>\n<section id=\"references\">\n<h2>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<div role=\"list\" class=\"citation-list\">\n<div class=\"citation\" id=\"garyfallidis17\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id1\">Garyfallidis17</a><span class=\"fn-bracket\">]</span></span>\n<p>Garyfallidis et al. Recognition of white matter bundles using local and\nglobal streamline-based registration and clustering, Neuroimage, 2017</p>\n</div>\n<div class=\"citation\" id=\"yeh18\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id2\">Yeh18</a><span class=\"fn-bracket\">]</span></span>\n<p>Yeh F.C., Panesar S., Fernandes D., Meola A., Yoshino M.,\nFernandez-Miranda J.C., Vettel J.M., Verstynen T.\nPopulation-averaged atlas of the macroscale human structural\nconnectome and its network topology.\nNeuroimage, 2018.</p>\n</div>\n<div class=\"citation\" id=\"garyfallidis15\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id3\">Garyfallidis15</a><span class=\"fn-bracket\">]</span></span>\n<p>Garyfallidis et al., \u201cRobust and efficient linear registration of\nwhite-matter fascicles in the space of streamlines\u201d, Neuroimage,\n117:124-140, 2015.</p>\n</div>\n<div class=\"citation\" id=\"garyfallidis14\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id4\">Garyfallidis14</a><span class=\"fn-bracket\">]</span></span>\n<p>Garyfallidis, E., M. Brett, B. Amirbekian, A. Rokem,\nS. Van Der Walt, M. Descoteaux, and I. Nimmo-Smith.\n\u201cDIPY, a library for the analysis of diffusion MRI data\u201d.\nFrontiers in Neuroinformatics, 1-18, 2014.</p>\n</div>\n</div>\n</section>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["faq", "Frequently Asked Questions", "N", "next"], ["interfaces/buan_flow", "BUndle ANalytics (BUAN) framework", "P", "previous"]], "sourcename": "interfaces/bundle_segmentation_flow.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">White Matter Bundle Segmentation with RecoBundles</a><ul>\n<li><a class=\"reference internal\" href=\"#streamline-based-linear-registration\">Streamline-Based Linear Registration</a></li>\n<li><a class=\"reference internal\" href=\"#recobundles\">RecoBundles</a></li>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "interfaces/bundle_segmentation_flow", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}