{"parents": [], "prev": null, "next": null, "title": "Reslice diffusion datasets", "meta": {}, "body": "<div class=\"sphx-glr-download-link-note admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>Click <a class=\"reference internal\" href=\"#sphx-glr-download-examples-built-preprocessing-reslice-datasets-py\"><span class=\"std std-ref\">here</span></a>     to download the full example code</p>\n</div>\n<div class=\"sphx-glr-example-title section\" id=\"reslice-diffusion-datasets\">\n<span id=\"sphx-glr-examples-built-preprocessing-reslice-datasets-py\"></span><h1>Reslice diffusion datasets<a class=\"headerlink\" href=\"#reslice-diffusion-datasets\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"section\" id=\"overview\">\n<h2>Overview<a class=\"headerlink\" href=\"#overview\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Often in imaging it is common to reslice images in different resolutions.\nEspecially in dMRI we usually want images with isotropic voxel size as they\nfacilitate most tractography algorithms. In this example we show how you\ncan reslice a dMRI dataset to have isotropic voxel size.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">nibabel</span> <span class=\"k\">as</span> <span class=\"nn\">nib</span>\n</pre></div>\n</div>\n<p>The function we need to use is called resample.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">dipy.align.reslice</span> <span class=\"k\">import</span> <span class=\"n\">reslice</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.data</span> <span class=\"k\">import</span> <span class=\"n\">get_fnames</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.image</span> <span class=\"k\">import</span> <span class=\"n\">load_nifti</span><span class=\"p\">,</span> <span class=\"n\">save_nifti</span>\n</pre></div>\n</div>\n<p>We use here a very small dataset to show the basic principles but you can\nreplace the following line with the path of your image.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fimg</span> <span class=\"o\">=</span> <span class=\"n\">get_fnames</span><span class=\"p\">(</span><span class=\"s1\">&#39;aniso_vox&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>We load the image, the affine of the image and the voxel size. The affine is\nthe transformation matrix which maps image coordinates to world (mm)\ncoordinates. Then, we print the shape of the volume</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">affine</span><span class=\"p\">,</span> <span class=\"n\">voxel_size</span> <span class=\"o\">=</span> <span class=\"n\">load_nifti</span><span class=\"p\">(</span><span class=\"n\">fimg</span><span class=\"p\">,</span> <span class=\"n\">return_voxsize</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">voxel_size</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p class=\"sphx-glr-script-out\">Out:</p>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>(58, 58, 24)\n(4.0, 4.0, 5.0)\n</pre></div>\n</div>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">(58,</span> <span class=\"pre\">58,</span> <span class=\"pre\">24)</span></code>\n<code class=\"docutils literal notranslate\"><span class=\"pre\">(4.0,</span> <span class=\"pre\">4.0,</span> <span class=\"pre\">5.0)</span></code></p>\n<p>Set the required new voxel size.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">new_voxel_size</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mf\">3.</span><span class=\"p\">,</span> <span class=\"mf\">3.</span><span class=\"p\">,</span> <span class=\"mf\">3.</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">new_voxel_size</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p class=\"sphx-glr-script-out\">Out:</p>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>(3.0, 3.0, 3.0)\n</pre></div>\n</div>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">(3.0,</span> <span class=\"pre\">3.0,</span> <span class=\"pre\">3.0)</span></code></p>\n<p>Start resampling (reslicing). Trilinear interpolation is used by default.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">data2</span><span class=\"p\">,</span> <span class=\"n\">affine2</span> <span class=\"o\">=</span> <span class=\"n\">reslice</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">affine</span><span class=\"p\">,</span> <span class=\"n\">voxel_size</span><span class=\"p\">,</span> <span class=\"n\">new_voxel_size</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">data2</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p class=\"sphx-glr-script-out\">Out:</p>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>(77, 77, 40)\n</pre></div>\n</div>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">(77,</span> <span class=\"pre\">77,</span> <span class=\"pre\">40)</span></code></p>\n<p>Save the result as a new Nifti file.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">save_nifti</span><span class=\"p\">(</span><span class=\"s1\">&#39;iso_vox.nii.gz&#39;</span><span class=\"p\">,</span> <span class=\"n\">data2</span><span class=\"p\">,</span> <span class=\"n\">affine2</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Or as analyze format or any other supported format.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">img3</span> <span class=\"o\">=</span> <span class=\"n\">nib</span><span class=\"o\">.</span><span class=\"n\">Spm2AnalyzeImage</span><span class=\"p\">(</span><span class=\"n\">data2</span><span class=\"p\">,</span> <span class=\"n\">affine2</span><span class=\"p\">)</span>\n<span class=\"n\">nib</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">img3</span><span class=\"p\">,</span> <span class=\"s1\">&#39;iso_vox.img&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Done. Check your datasets. As you may have already realized the same\ncode can be used for general reslicing problems not only for dMRI data.</p>\n<p class=\"sphx-glr-timing\"><strong>Total running time of the script:</strong> ( 0 minutes  0.106 seconds)</p>\n<div class=\"sphx-glr-footer class sphx-glr-footer-example docutils container\" id=\"sphx-glr-download-examples-built-preprocessing-reslice-datasets-py\">\n<div class=\"sphx-glr-download sphx-glr-download-python docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/a937f980511775ed1ef040b0e526ef9b/reslice_datasets.py\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Python</span> <span class=\"pre\">source</span> <span class=\"pre\">code:</span> <span class=\"pre\">reslice_datasets.py</span></code></a></p>\n</div>\n<div class=\"sphx-glr-download sphx-glr-download-jupyter docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/551b8f6df3883201452c4545df2760b4/reslice_datasets.ipynb\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Jupyter</span> <span class=\"pre\">notebook:</span> <span class=\"pre\">reslice_datasets.ipynb</span></code></a></p>\n</div>\n</div>\n<p class=\"sphx-glr-signature\"><a class=\"reference external\" href=\"https://sphinx-gallery.github.io\">Gallery generated by Sphinx-Gallery</a></p>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"]], "sourcename": "examples_built/preprocessing/reslice_datasets.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Reslice diffusion datasets</a><ul>\n<li><a class=\"reference internal\" href=\"#overview\">Overview</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "examples_built/preprocessing/reslice_datasets", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}