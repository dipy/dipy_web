{"parents": [{"link": "../../../documentation/", "title": "Documentation"}, {"link": "../../", "title": "Examples"}, {"link": "../", "title": "Segmentation"}], "prev": {"link": "../segment_clustering_features/", "title": "Tractography Clustering - Available Features"}, "next": {"link": "../../26_simulations/", "title": "Simulation"}, "title": "Automatic Fiber Bundle Extraction with RecoBundles", "meta": null, "body": "<div class=\"sphx-glr-download-link-note admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>Click <a class=\"reference internal\" href=\"#sphx-glr-download-examples-built-23-segmentation-bundle-extraction-py\"><span class=\"std std-ref\">here</span></a>\nto download the full example code</p>\n</div>\n<section class=\"sphx-glr-example-title\" id=\"automatic-fiber-bundle-extraction-with-recobundles\">\n<span id=\"sphx-glr-examples-built-23-segmentation-bundle-extraction-py\"></span><h1>Automatic Fiber Bundle Extraction with RecoBundles<a class=\"headerlink\" href=\"#automatic-fiber-bundle-extraction-with-recobundles\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p>This example explains how we can use RecoBundles <a class=\"reference internal\" href=\"#garyfallidis17\" id=\"id1\"><span>[Garyfallidis17]</span></a> to extract\nbundles from tractograms.</p>\n<p>First import the necessary modules.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.align.streamlinear</span> <span class=\"kn\">import</span> <span class=\"n\">whole_brain_slr</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.data</span> <span class=\"kn\">import</span> <span class=\"n\">get_two_hcp842_bundles</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.data</span> <span class=\"kn\">import</span> <span class=\"p\">(</span><span class=\"n\">fetch_target_tractogram_hcp</span><span class=\"p\">,</span>\n                       <span class=\"n\">fetch_bundle_atlas_hcp842</span><span class=\"p\">,</span>\n                       <span class=\"n\">get_bundle_atlas_hcp842</span><span class=\"p\">,</span>\n                       <span class=\"n\">get_target_tractogram_hcp</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.stateful_tractogram</span> <span class=\"kn\">import</span> <span class=\"n\">Space</span><span class=\"p\">,</span> <span class=\"n\">StatefulTractogram</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.streamline</span> <span class=\"kn\">import</span> <span class=\"n\">load_trk</span><span class=\"p\">,</span> <span class=\"n\">save_trk</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.utils</span> <span class=\"kn\">import</span> <span class=\"n\">create_tractogram_header</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.segment.bundles</span> <span class=\"kn\">import</span> <span class=\"n\">RecoBundles</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.viz</span> <span class=\"kn\">import</span> <span class=\"n\">actor</span><span class=\"p\">,</span> <span class=\"n\">window</span>\n</pre></div>\n</div>\n<p>Download and read data for this tutorial</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">target_file</span><span class=\"p\">,</span> <span class=\"n\">target_folder</span> <span class=\"o\">=</span> <span class=\"n\">fetch_target_tractogram_hcp</span><span class=\"p\">()</span>\n<span class=\"n\">atlas_file</span><span class=\"p\">,</span> <span class=\"n\">atlas_folder</span> <span class=\"o\">=</span> <span class=\"n\">fetch_bundle_atlas_hcp842</span><span class=\"p\">()</span>\n\n<span class=\"n\">atlas_file</span><span class=\"p\">,</span> <span class=\"n\">all_bundles_files</span> <span class=\"o\">=</span> <span class=\"n\">get_bundle_atlas_hcp842</span><span class=\"p\">()</span>\n<span class=\"n\">target_file</span> <span class=\"o\">=</span> <span class=\"n\">get_target_tractogram_hcp</span><span class=\"p\">()</span>\n\n<span class=\"n\">sft_atlas</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">atlas_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">atlas</span> <span class=\"o\">=</span> <span class=\"n\">sft_atlas</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n<span class=\"n\">atlas_header</span> <span class=\"o\">=</span> <span class=\"n\">create_tractogram_header</span><span class=\"p\">(</span><span class=\"n\">atlas_file</span><span class=\"p\">,</span>\n                                        <span class=\"o\">*</span><span class=\"n\">sft_atlas</span><span class=\"o\">.</span><span class=\"n\">space_attributes</span><span class=\"p\">)</span>\n\n<span class=\"n\">sft_target</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">target_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">sft_target</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n<span class=\"n\">target_header</span> <span class=\"o\">=</span> <span class=\"n\">create_tractogram_header</span><span class=\"p\">(</span><span class=\"n\">target_file</span><span class=\"p\">,</span>\n                                         <span class=\"o\">*</span><span class=\"n\">sft_target</span><span class=\"o\">.</span><span class=\"n\">space_attributes</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize atlas tractogram and target tractogram before registration</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">atlas</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractograms_initial.png&#39;</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_001.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_001.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id4\">\n<img alt=\"examples_built/23_segmentation/tractograms_initial.png\" src=\"examples_built/23_segmentation/tractograms_initial.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Atlas and target before registration.</span><a class=\"headerlink\" href=\"#id4\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>We will register target tractogram to model atlas\u2019 space using streamlinear\nregistration (SLR) <a class=\"reference internal\" href=\"../../20_registration/bundle_registration/#garyfallidis15\" id=\"id2\"><span>[Garyfallidis15]</span></a></p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">moved</span><span class=\"p\">,</span> <span class=\"n\">transform</span><span class=\"p\">,</span> <span class=\"n\">qb_centroids1</span><span class=\"p\">,</span> <span class=\"n\">qb_centroids2</span> <span class=\"o\">=</span> <span class=\"n\">whole_brain_slr</span><span class=\"p\">(</span>\n    <span class=\"n\">atlas</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">x0</span><span class=\"o\">=</span><span class=\"s1\">&#39;affine&#39;</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">progressive</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"n\">rng</span><span class=\"o\">=</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">RandomState</span><span class=\"p\">(</span><span class=\"mi\">1984</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<p>We save the transform generated in this registration, so that we can use\nit in the bundle profiles example</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"s2\">&quot;slr_transform.npy&quot;</span><span class=\"p\">,</span> <span class=\"n\">transform</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize atlas tractogram and target tractogram after registration</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">atlas</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">moved</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractograms_after_registration.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_002.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_002.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id5\">\n<img alt=\"examples_built/23_segmentation/tractograms_after_registration.png\" src=\"examples_built/23_segmentation/tractograms_after_registration.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Atlas and target after registration.</span><a class=\"headerlink\" href=\"#id5\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Extracting bundles using RecoBundles <a class=\"reference internal\" href=\"#garyfallidis17\" id=\"id3\"><span>[Garyfallidis17]</span></a></p>\n<p>RecoBundles requires a model (reference) bundle and tries to extract similar\nlooking bundle from the input tractogram. There are some key parameters that\nusers can set as per requirements. Here are the key threshold parameters\nmeasured in millimeters and their function in Recobundles:</p>\n<blockquote>\n<div><ul class=\"simple\">\n<li><p>model_clust_thr : It will use QuickBundles to get the centroids of the</p></li>\n</ul>\n<p>model bundle and work with centroids instead of all streamlines. This helps\nto make RecoBundles faster. The larger the value of the threshold, the\nfewer centroids will be, the and smaller the threshold value, the more\ncentroids will be. If you prefer to use all the streamlines of the model\nbundle, you can set this threshold to 0.01 mm.\nRecommended range of the model_clust_thr is 0.01 - 3.0 mm.</p>\n<ul class=\"simple\">\n<li><p>reduction_thr : This threshold will be used to reduce the search space</p></li>\n</ul>\n<p>for finding the streamlines that match model bundle streamlines in shape.\nInstead of looking at the entire tractogram, now we will be looking at\nneighboring region of a model bundle in the tractogram. Increase the\nthreshold to increase the search space.\nRecommended range of the reduction_thr is 15 - 30 mm.</p>\n<ul class=\"simple\">\n<li><p>pruning_thr : This threshold will filter the streamlines for which the</p></li>\n</ul>\n<p>distance to the model bundle is greater than the pruning_thr.\nThis serves to filter the neighborhood area (search space) to get\nstreamlines that are like the model bundle.\nRecommended range of the pruning_thr is 8 - 12 mm.</p>\n<ul class=\"simple\">\n<li><p>reduction_distance and pruning_distance : Distance method used internally.</p></li>\n</ul>\n<p>Minimum Diferect Flip distance (mdf) or Mean Average Minimum (mam).\nDefault is set to mdf.</p>\n<ul class=\"simple\">\n<li><p>slr : If slr flag is set to True, local registration of model bundle with</p></li>\n</ul>\n<p>neighbouring area will be performed. Default and recommended is True.</p>\n</div></blockquote>\n<p>Read Arcuate Fasciculus Left and Corticospinal Tract Left bundles from already\nfetched atlas data to use them as model bundle. Let\u2019s visualize the\nArcuate Fasciculus Left model bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">model_af_l_file</span><span class=\"p\">,</span> <span class=\"n\">model_cst_l_file</span> <span class=\"o\">=</span> <span class=\"n\">get_two_hcp842_bundles</span><span class=\"p\">()</span>\n<span class=\"n\">sft_af_l</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">model_af_l_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">model_af_l</span> <span class=\"o\">=</span> <span class=\"n\">sft_af_l</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n\n<span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">model_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_model_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_003.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_003.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id6\">\n<img alt=\"examples_built/23_segmentation/AF_L_model_bundle.png\" src=\"examples_built/23_segmentation/AF_L_model_bundle.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Model Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id6\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">rb</span> <span class=\"o\">=</span> <span class=\"n\">RecoBundles</span><span class=\"p\">(</span><span class=\"n\">moved</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">rng</span><span class=\"o\">=</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">RandomState</span><span class=\"p\">(</span><span class=\"mi\">2001</span><span class=\"p\">))</span>\n\n<span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                            <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">7</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Arcuate Fasciculus Left bundle</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_004.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_004.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id7\">\n<img alt=\"examples_built/23_segmentation/AF_L_recognized_bundle.png\" src=\"examples_built/23_segmentation/AF_L_recognized_bundle.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id7\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                            <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Arcuate Fasciculus Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_recognized_bundle2.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_005.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_005.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id8\">\n<img alt=\"examples_built/23_segmentation/AF_L_recognized_bundle2.png\" src=\"examples_built/23_segmentation/AF_L_recognized_bundle2.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id8\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values further.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                            <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">25</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Arcuate Fasciculus Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_recognized_bundle3.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_006.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_006.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id9\">\n<img alt=\"examples_built/23_segmentation/AF_L_recognized_bundle3.png\" src=\"examples_built/23_segmentation/AF_L_recognized_bundle3.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id9\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s apply auto-calibrated RecoBundles on the output of standard RecoBundles.\nThis step will filter out the outlier streamlines. This time, the RecoBundles\u2019\nextracted bundle will serve as a model bundle. As a rule of thumb, provide\nlarger threshold values in standard RecoBundles function and smaller values in\nthe auto-calibrated RecoBundles (refinement) step.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">r_recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">r_af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">refine</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                             <span class=\"n\">pruned_streamlines</span><span class=\"o\">=</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span>\n                                             <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                             <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                             <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">6</span><span class=\"p\">,</span>\n                                             <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                             <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                             <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted refined Arcuate Fasciculus Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">r_recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_refine_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_007.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_007.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id10\">\n<img alt=\"examples_built/23_segmentation/AF_L_refine_recognized_bundle.png\" src=\"examples_built/23_segmentation/AF_L_refine_recognized_bundle.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id10\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">r_recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">r_af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s load Corticospinal Tract Left model bundle and visualize it.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">sft_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">model_cst_l_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">model_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">sft_cst_l</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n\n<span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">model_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_model_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_008.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_008.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id11\">\n<img alt=\"examples_built/23_segmentation/CST_L_model_bundle.png\" src=\"examples_built/23_segmentation/CST_L_model_bundle.png\" />\n<figcaption>\n<p><span class=\"caption-text\">The Corticospinal tract model bundle</span><a class=\"headerlink\" href=\"#id11\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                              <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">7</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Corticospinal tract Left bundle</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_009.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_009.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id12\">\n<img alt=\"examples_built/23_segmentation/CST_L_recognized_bundle.png\" src=\"examples_built/23_segmentation/CST_L_recognized_bundle.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id12\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                              <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Corticospinal tract Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_recognized_bundle2.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_010.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_010.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id13\">\n<img alt=\"examples_built/23_segmentation/CST_L_recognized_bundle2.png\" src=\"examples_built/23_segmentation/CST_L_recognized_bundle2.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id13\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values further.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                              <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">25</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Corticospinal tract Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_recognized_bundle3.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_011.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_011.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id14\">\n<img alt=\"examples_built/23_segmentation/CST_L_recognized_bundle3.png\" src=\"examples_built/23_segmentation/CST_L_recognized_bundle3.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id14\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s apply auto-calibrated RecoBundles on the output of standard RecoBundles.\nThis step will filter out the outlier streamlines. This time, the RecoBundles\u2019\nextracted bundle will serve as a model bundle. As a rule of thumb, provide\nlarger threshold values in standard RecoBundles function and smaller values in\nthe auto-calibrated RecoBundles (refinement) step.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">r_recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">r_cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">refine</span><span class=\"p\">(</span>\n                                     <span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                     <span class=\"n\">pruned_streamlines</span><span class=\"o\">=</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span>\n                                     <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                     <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                     <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">6</span><span class=\"p\">,</span>\n                                     <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                     <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                     <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted refined Corticospinal tract Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">r_recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_refine_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_extraction_012.png\" srcset=\"../../_images/sphx_glr_bundle_extraction_012.png\" alt=\"bundle extraction\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id15\">\n<img alt=\"examples_built/23_segmentation/CST_L_refine_recognized_bundle.png\" src=\"examples_built/23_segmentation/CST_L_refine_recognized_bundle.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Extracted refined Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id15\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">r_recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">r_cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>This example shows how changing different threshold parameters can change the\noutput. It is up to the user to decide what is the desired output and select\nparameters accordingly.</p>\n<section id=\"references\">\n<h2>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<div role=\"list\" class=\"citation-list\">\n<div class=\"citation\" id=\"garyfallidis17\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span>Garyfallidis17<span class=\"fn-bracket\">]</span></span>\n<span class=\"backrefs\">(<a role=\"doc-backlink\" href=\"#id1\">1</a>,<a role=\"doc-backlink\" href=\"#id3\">2</a>)</span>\n<p>Garyfallidis et al. Recognition of white matter\nbundles using local and global streamline-based registration\nand clustering, Neuroimage, 2017.</p>\n</div>\n<div class=\"citation\" id=\"chandio2020\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span>Chandio2020<span class=\"fn-bracket\">]</span></span>\n<p>Chandio, B.Q., Risacher, S.L., Pestilli, F.,\nBullock, D., Yeh, FC., Koudoro, S., Rokem, A., Harezlak, J., and\nGaryfallidis, E. Bundle analytics, a computational framework for\ninvestigating the shapes and profiles of brain pathways across\npopulations. Sci Rep 10, 17149 (2020)</p>\n</div>\n</div>\n<p class=\"sphx-glr-timing\"><strong>Total running time of the script:</strong> ( 2 minutes  5.826 seconds)</p>\n<div class=\"sphx-glr-footer sphx-glr-footer-example docutils container\" id=\"sphx-glr-download-examples-built-23-segmentation-bundle-extraction-py\">\n<div class=\"sphx-glr-download sphx-glr-download-python docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/c7582408687b227080888da9f6815bb4/bundle_extraction.py\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Python</span> <span class=\"pre\">source</span> <span class=\"pre\">code:</span> <span class=\"pre\">bundle_extraction.py</span></code></a></p>\n</div>\n<div class=\"sphx-glr-download sphx-glr-download-jupyter docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/9946a6b74b27228ec2763eb464a00855/bundle_extraction.ipynb\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Jupyter</span> <span class=\"pre\">notebook:</span> <span class=\"pre\">bundle_extraction.ipynb</span></code></a></p>\n</div>\n</div>\n<p class=\"sphx-glr-signature\"><a class=\"reference external\" href=\"https://sphinx-gallery.github.io\">Gallery generated by Sphinx-Gallery</a></p>\n</section>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["examples_built/26_simulations/index", "Simulation", "N", "next"], ["examples_built/23_segmentation/segment_clustering_features", "Tractography Clustering - Available Features", "P", "previous"]], "sourcename": "examples_built/23_segmentation/bundle_extraction.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Automatic Fiber Bundle Extraction with RecoBundles</a><ul>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "examples_built/23_segmentation/bundle_extraction", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}