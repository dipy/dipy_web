{"parents": [{"link": "../../../documentation/", "title": "Documentation"}, {"link": "../../", "title": "Examples"}, {"link": "../", "title": "Registration"}], "prev": {"link": "../", "title": "Registration"}, "next": {"link": "../bundle_registration/", "title": "Direct Bundle Registration"}, "title": "Groupwise Bundle Registration", "meta": null, "body": "<div class=\"sphx-glr-download-link-note admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>Click <a class=\"reference internal\" href=\"#sphx-glr-download-examples-built-20-registration-bundle-group-registration-py\"><span class=\"std std-ref\">here</span></a>\nto download the full example code</p>\n</div>\n<section class=\"sphx-glr-example-title\" id=\"groupwise-bundle-registration\">\n<span id=\"sphx-glr-examples-built-20-registration-bundle-group-registration-py\"></span><h1>Groupwise Bundle Registration<a class=\"headerlink\" href=\"#groupwise-bundle-registration\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p>This example explains how to coregister a set of bundles to a common space that\nis not biased by any specific bundle. This is useful when we want to align all\nthe bundles but do not have a target reference space defined by an atlas.</p>\n<section id=\"how-it-works\">\n<h2>How it works<a class=\"headerlink\" href=\"#how-it-works\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>The bundle groupwise registration framework in DIPY relies on streamline linear\nregistration (SLR) <a class=\"reference internal\" href=\"../bundle_registration/#garyfallidis15\" id=\"id1\"><span>[Garyfallidis15]</span></a> and an iterative process.</p>\n<p>In each iteration, bundles are shuffled and matched in pairs. Then, each pair\nof bundles are simultaneously moved to a common space in between both.</p>\n<p>After all pairs have been aligned, a group distance metric is computed as the\nmean pairwise distance between all bundle pairs. With each iteration, bundles\nget closer to each other and the group distance decreases.</p>\n<p>When the reduction in the group distance reaches a tolerance level the process\nends.</p>\n<p>To reduce computational time, by default both registration and distance\ncomputation are performed on streamline centroids (obtained with Quickbundles)\n<a class=\"reference internal\" href=\"../../23_segmentation/segment_quickbundles/#garyfallidis12\" id=\"id2\"><span>[Garyfallidis12]</span></a>.</p>\n</section>\n<section id=\"example\">\n<h2>Example<a class=\"headerlink\" href=\"#example\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>We start by importing and creating the necessary functions:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">dipy.align.streamlinear</span> <span class=\"kn\">import</span> <span class=\"n\">groupwise_slr</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.data</span> <span class=\"kn\">import</span> <span class=\"n\">read_five_af_bundles</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.viz.streamline</span> <span class=\"kn\">import</span> <span class=\"n\">show_bundles</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">basicConfig</span><span class=\"p\">(</span><span class=\"n\">level</span><span class=\"o\">=</span><span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">INFO</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>To run groupwise registration we need to have our input bundles stored in a\nlist.</p>\n<p>Here we load 5 left arcuate fasciculi and store them in a list.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">bundles</span> <span class=\"o\">=</span> <span class=\"n\">read_five_af_bundles</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Let\u2019s now visualize our input bundles:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"p\">[[</span><span class=\"mf\">0.91</span><span class=\"p\">,</span> <span class=\"mf\">0.26</span><span class=\"p\">,</span> <span class=\"mf\">0.35</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"mf\">0.99</span><span class=\"p\">,</span> <span class=\"mf\">0.50</span><span class=\"p\">,</span> <span class=\"mf\">0.38</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"mf\">0.99</span><span class=\"p\">,</span> <span class=\"mf\">0.88</span><span class=\"p\">,</span> <span class=\"mf\">0.57</span><span class=\"p\">],</span>\n          <span class=\"p\">[</span><span class=\"mf\">0.69</span><span class=\"p\">,</span> <span class=\"mf\">0.85</span><span class=\"p\">,</span> <span class=\"mf\">0.64</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"mf\">0.51</span><span class=\"p\">,</span> <span class=\"mf\">0.51</span><span class=\"p\">,</span> <span class=\"mf\">0.63</span><span class=\"p\">]]</span>\n\n<span class=\"n\">show_bundles</span><span class=\"p\">(</span><span class=\"n\">bundles</span><span class=\"p\">,</span> <span class=\"n\">interactive</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">colors</span><span class=\"p\">,</span>\n             <span class=\"n\">save_as</span><span class=\"o\">=</span><span class=\"s1\">&#39;before_group_registration.png&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_group_registration_001.png\" srcset=\"../../_images/sphx_glr_bundle_group_registration_001.png\" alt=\"bundle group registration\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id3\">\n<img alt=\"examples_built/20_registration/before_group_registration.png\" src=\"examples_built/20_registration/before_group_registration.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Bundles before registration.</span><a class=\"headerlink\" href=\"#id3\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>They are in native space and, therefore, not aligned.</p>\n<p>Now running groupwise registration is as simple as:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">bundles_reg</span><span class=\"p\">,</span> <span class=\"n\">aff</span><span class=\"p\">,</span> <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">groupwise_slr</span><span class=\"p\">(</span><span class=\"n\">bundles</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Finally, we visualize the registered bundles to confirm that they are now in a\ncommon space:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">show_bundles</span><span class=\"p\">(</span><span class=\"n\">bundles_reg</span><span class=\"p\">,</span> <span class=\"n\">interactive</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">colors</span><span class=\"p\">,</span>\n             <span class=\"n\">save_as</span><span class=\"o\">=</span><span class=\"s1\">&#39;after_group_registration.png&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_bundle_group_registration_002.png\" srcset=\"../../_images/sphx_glr_bundle_group_registration_002.png\" alt=\"bundle group registration\" class = \"sphx-glr-single-img\"/><figure class=\"align-center\" id=\"id4\">\n<img alt=\"examples_built/20_registration/after_group_registration.png\" src=\"examples_built/20_registration/after_group_registration.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Bundles after registration.</span><a class=\"headerlink\" href=\"#id4\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n</section>\n<section id=\"extended-capabilities\">\n<h2>Extended capabilities<a class=\"headerlink\" href=\"#extended-capabilities\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>In addition to the registered bundles, <cite>groupwise_slr</cite> also returns a list with\nthe individual transformation matrices as well as the pairwise distances\ncomputed in each iteration.</p>\n<p>By changing the input arguments the user can modify the transformation (up to\naffine), the number of maximum number of streamlines per bundle, the level of\nclustering, or the tolerance of the method.</p>\n<section id=\"references\">\n<h3>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<div role=\"list\" class=\"citation-list\">\n<div class=\"citation\" id=\"garyfallidis15\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id1\">Garyfallidis15</a><span class=\"fn-bracket\">]</span></span>\n<p>Garyfallidis et al., \u201cRobust and efficient linear\nregistration of white-matter fascicles in the space of\nstreamlines\u201d, Neuroimage, 117:124-140, 2015.</p>\n</div>\n<div class=\"citation\" id=\"garyfallidis12\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id2\">Garyfallidis12</a><span class=\"fn-bracket\">]</span></span>\n<p>Garyfallidis E. et al., \u201cQuickBundles a method for\ntractography simplification\u201d, Frontiers in Neuroscience,\nvol 6, no 175, 2012.</p>\n</div>\n<div class=\"citation\" id=\"romerobascones22\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span>RomeroBascones22<span class=\"fn-bracket\">]</span></span>\n<p>Romero-Bascones D. et al., \u201cBundleAtlasing: unbiased\npopulation-specific atlasing of bundles in streamline\nspace\u201d, ISMRM, 2022.</p>\n</div>\n</div>\n<p class=\"sphx-glr-timing\"><strong>Total running time of the script:</strong> ( 0 minutes  3.769 seconds)</p>\n<div class=\"sphx-glr-footer sphx-glr-footer-example docutils container\" id=\"sphx-glr-download-examples-built-20-registration-bundle-group-registration-py\">\n<div class=\"sphx-glr-download sphx-glr-download-python docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/38b833e11bc2c816ee6af299c41c102d/bundle_group_registration.py\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Python</span> <span class=\"pre\">source</span> <span class=\"pre\">code:</span> <span class=\"pre\">bundle_group_registration.py</span></code></a></p>\n</div>\n<div class=\"sphx-glr-download sphx-glr-download-jupyter docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/22f32f5988bc2cb6e6dec45884b2a877/bundle_group_registration.ipynb\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Jupyter</span> <span class=\"pre\">notebook:</span> <span class=\"pre\">bundle_group_registration.ipynb</span></code></a></p>\n</div>\n</div>\n<p class=\"sphx-glr-signature\"><a class=\"reference external\" href=\"https://sphinx-gallery.github.io\">Gallery generated by Sphinx-Gallery</a></p>\n</section>\n</section>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["examples_built/20_registration/bundle_registration", "Direct Bundle Registration", "N", "next"], ["examples_built/20_registration/index", "Registration", "P", "previous"]], "sourcename": "examples_built/20_registration/bundle_group_registration.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Groupwise Bundle Registration</a><ul>\n<li><a class=\"reference internal\" href=\"#how-it-works\">How it works</a></li>\n<li><a class=\"reference internal\" href=\"#example\">Example</a></li>\n<li><a class=\"reference internal\" href=\"#extended-capabilities\">Extended capabilities</a><ul>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "examples_built/20_registration/bundle_group_registration", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}