{"parents": [{"link": "../../../documentation/", "title": "Documentation"}, {"link": "../../", "title": "Examples"}, {"link": "../", "title": "Preprocessing"}], "prev": {"link": "../denoise_localpca/", "title": "Denoise images using Local PCA via empirical thresholds"}, "next": {"link": "../denoise_ascm/", "title": "Denoise images using Adaptive Soft Coefficient Matching (ASCM)"}, "title": "Gradients and Spheres", "meta": null, "body": "<div class=\"sphx-glr-download-link-note admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>Click <a class=\"reference internal\" href=\"#sphx-glr-download-examples-built-04-preprocessing-gradients-spheres-py\"><span class=\"std std-ref\">here</span></a>\nto download the full example code</p>\n</div>\n<section class=\"sphx-glr-example-title\" id=\"gradients-and-spheres\">\n<span id=\"sphx-glr-examples-built-04-preprocessing-gradients-spheres-py\"></span><h1>Gradients and Spheres<a class=\"headerlink\" href=\"#gradients-and-spheres\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p>This example shows how you can create gradient tables and sphere objects using\n<a href=\"#id5\"><span class=\"problematic\" id=\"id6\">DIPY_</span></a>.</p>\n<p>Usually, as we saw in <span class=\"xref std std-ref\">example_quick_start</span>, you load your b-values and\nb-vectors from disk and then you can create your own gradient table. But\nthis time let\u2019s say that you are an MR physicist and you want to design a new\ngradient scheme or you are a scientist who wants to simulate many different\ngradient schemes.</p>\n<p>Now let\u2019s assume that you are interested in creating a multi-shell\nacquisition with 2-shells, one at b=1000 <span class=\"math notranslate nohighlight\">\\(s/mm^2\\)</span> and one at b=2500 <span class=\"math notranslate nohighlight\">\\(s/mm^2\\)</span>.\nFor both shells let\u2019s say that we want a specific number of gradients (64) and\nwe want to have the points on the sphere evenly distributed.</p>\n<p>This is possible using the <code class=\"docutils literal notranslate\"><span class=\"pre\">disperse_charges</span></code> which is an implementation of\nelectrostatic repulsion <a class=\"reference internal\" href=\"#jones1999\" id=\"id1\"><span>[Jones1999]</span></a>.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.core.sphere</span> <span class=\"kn\">import</span> <span class=\"n\">disperse_charges</span><span class=\"p\">,</span> <span class=\"n\">Sphere</span><span class=\"p\">,</span> <span class=\"n\">HemiSphere</span>\n</pre></div>\n</div>\n<p>We can first create some random points on a <code class=\"docutils literal notranslate\"><span class=\"pre\">HemiSphere</span></code> using spherical polar\ncoordinates.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">n_pts</span> <span class=\"o\">=</span> <span class=\"mi\">64</span>\n<span class=\"n\">theta</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">pi</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">rand</span><span class=\"p\">(</span><span class=\"n\">n_pts</span><span class=\"p\">)</span>\n<span class=\"n\">phi</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">pi</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">rand</span><span class=\"p\">(</span><span class=\"n\">n_pts</span><span class=\"p\">)</span>\n<span class=\"n\">hsph_initial</span> <span class=\"o\">=</span> <span class=\"n\">HemiSphere</span><span class=\"p\">(</span><span class=\"n\">theta</span><span class=\"o\">=</span><span class=\"n\">theta</span><span class=\"p\">,</span> <span class=\"n\">phi</span><span class=\"o\">=</span><span class=\"n\">phi</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Next, we call <code class=\"docutils literal notranslate\"><span class=\"pre\">disperse_charges</span></code> which will iteratively move the points so that\nthe electrostatic potential energy is minimized.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">hsph_updated</span><span class=\"p\">,</span> <span class=\"n\">potential</span> <span class=\"o\">=</span> <span class=\"n\">disperse_charges</span><span class=\"p\">(</span><span class=\"n\">hsph_initial</span><span class=\"p\">,</span> <span class=\"mi\">5000</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>In <code class=\"docutils literal notranslate\"><span class=\"pre\">hsph_updated</span></code> we have the updated <code class=\"docutils literal notranslate\"><span class=\"pre\">HemiSphere</span></code> with the points nicely\ndistributed on the hemisphere. Let\u2019s visualize them.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">dipy.viz</span> <span class=\"kn\">import</span> <span class=\"n\">window</span><span class=\"p\">,</span> <span class=\"n\">actor</span>\n\n<span class=\"c1\"># Enables/disables interactive visualization</span>\n<span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">point</span><span class=\"p\">(</span><span class=\"n\">hsph_initial</span><span class=\"o\">.</span><span class=\"n\">vertices</span><span class=\"p\">,</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">colors</span><span class=\"o\">.</span><span class=\"n\">red</span><span class=\"p\">,</span>\n                      <span class=\"n\">point_radius</span><span class=\"o\">=</span><span class=\"mf\">0.05</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">point</span><span class=\"p\">(</span><span class=\"n\">hsph_updated</span><span class=\"o\">.</span><span class=\"n\">vertices</span><span class=\"p\">,</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">colors</span><span class=\"o\">.</span><span class=\"n\">green</span><span class=\"p\">,</span>\n                      <span class=\"n\">point_radius</span><span class=\"o\">=</span><span class=\"mf\">0.05</span><span class=\"p\">))</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as initial_vs_updated.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;initial_vs_updated.png&#39;</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_gradients_spheres_001.png\" srcset=\"../../_images/sphx_glr_gradients_spheres_001.png\" alt=\"gradients spheres\" class = \"sphx-glr-single-img\"/><div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Saving illustration as initial_vs_updated.png\n</pre></div>\n</div>\n<figure class=\"align-center\" id=\"id2\">\n<img alt=\"examples_built/04_preprocessing/initial_vs_updated.png\" src=\"examples_built/04_preprocessing/initial_vs_updated.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Illustration of electrostatic repulsion of red points which become\ngreen points.</span><a class=\"headerlink\" href=\"#id2\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>We can also create a sphere from the hemisphere and show it in the\nfollowing way.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">sph</span> <span class=\"o\">=</span> <span class=\"n\">Sphere</span><span class=\"p\">(</span><span class=\"n\">xyz</span><span class=\"o\">=</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">vstack</span><span class=\"p\">((</span><span class=\"n\">hsph_updated</span><span class=\"o\">.</span><span class=\"n\">vertices</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"n\">hsph_updated</span><span class=\"o\">.</span><span class=\"n\">vertices</span><span class=\"p\">)))</span>\n\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">clear</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">point</span><span class=\"p\">(</span><span class=\"n\">sph</span><span class=\"o\">.</span><span class=\"n\">vertices</span><span class=\"p\">,</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">colors</span><span class=\"o\">.</span><span class=\"n\">green</span><span class=\"p\">,</span> <span class=\"n\">point_radius</span><span class=\"o\">=</span><span class=\"mf\">0.05</span><span class=\"p\">))</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as full_sphere.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;full_sphere.png&#39;</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_gradients_spheres_002.png\" srcset=\"../../_images/sphx_glr_gradients_spheres_002.png\" alt=\"gradients spheres\" class = \"sphx-glr-single-img\"/><div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Saving illustration as full_sphere.png\n</pre></div>\n</div>\n<figure class=\"align-center\" id=\"id3\">\n<img alt=\"examples_built/04_preprocessing/full_sphere.png\" src=\"examples_built/04_preprocessing/full_sphere.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Full sphere.</span><a class=\"headerlink\" href=\"#id3\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<p>It is time to create the Gradients. For this purpose we will use the\nfunction <code class=\"docutils literal notranslate\"><span class=\"pre\">gradient_table</span></code> and fill it with the <code class=\"docutils literal notranslate\"><span class=\"pre\">hsph_updated</span></code> vectors that\nwe created above.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">dipy.core.gradients</span> <span class=\"kn\">import</span> <span class=\"n\">gradient_table</span>\n\n<span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">hsph_updated</span><span class=\"o\">.</span><span class=\"n\">vertices</span>\n<span class=\"n\">values</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ones</span><span class=\"p\">(</span><span class=\"n\">vertices</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n</pre></div>\n</div>\n<p>We need two stacks of <code class=\"docutils literal notranslate\"><span class=\"pre\">vertices</span></code>, one for every shell, and we need two sets\nof b-values, one at 1000 <span class=\"math notranslate nohighlight\">\\(s/mm^2\\)</span>, and one at 2500 <span class=\"math notranslate nohighlight\">\\(s/mm^2\\)</span>, as we discussed\npreviously.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">bvecs</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">vstack</span><span class=\"p\">((</span><span class=\"n\">vertices</span><span class=\"p\">,</span> <span class=\"n\">vertices</span><span class=\"p\">))</span>\n<span class=\"n\">bvals</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">hstack</span><span class=\"p\">((</span><span class=\"mi\">1000</span> <span class=\"o\">*</span> <span class=\"n\">values</span><span class=\"p\">,</span> <span class=\"mi\">2500</span> <span class=\"o\">*</span> <span class=\"n\">values</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<p>We can also add some b0s. Let\u2019s add one at the beginning and one at the end.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">bvecs</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"n\">bvecs</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">bvecs</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">([</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">bvals</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"n\">bvals</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">bvals</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">bvals</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>[   0. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000.\n 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000.\n 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000.\n 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000.\n 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000. 1000.\n 1000. 1000. 1000. 1000. 1000. 2500. 2500. 2500. 2500. 2500. 2500. 2500.\n 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500.\n 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500.\n 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500.\n 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500.\n 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500. 2500.    0.]\n</pre></div>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span>    <span class=\"mf\">0.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>\n  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>\n  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>\n  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>\n  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>\n  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>\n  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">1000.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>\n  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>\n  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>\n  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>\n  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>\n  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>\n  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>  <span class=\"mf\">2500.</span>     <span class=\"mf\">0.</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">bvecs</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>[[ 0.          0.          0.        ]\n [ 0.48226551  0.8597359   0.16814924]\n [ 0.77169039  0.49362836  0.4010299 ]\n [ 0.91554673  0.21194055  0.34184117]\n [-0.7701603  -0.09150318  0.63125295]\n [-0.84451987  0.50221104  0.18593078]\n [-0.4654141  -0.57711311  0.67106644]\n [-0.07051484  0.19419914  0.97842442]\n [ 0.73214378  0.24406014  0.63592463]\n [-0.34081309  0.62007051  0.70665338]\n [-0.22612641 -0.05725387  0.97241392]\n [ 0.18986916  0.95549755  0.22577452]\n [ 0.92751189  0.36585046  0.07664942]\n [ 0.5401859  -0.41993756  0.72928159]\n [-0.58804797  0.4773355   0.65295513]\n [ 0.19614519  0.38822601  0.90044857]\n [ 0.62579607 -0.04787021  0.77851636]\n [ 0.92907407 -0.25474532  0.26819061]\n [-0.6961131  -0.55781155  0.45196552]\n [ 0.0728861  -0.76981131  0.63409634]\n [-0.97484953 -0.14227137  0.17154371]\n [-0.03030616 -0.99786452  0.05786142]\n [-0.42317947  0.88451485  0.1963482 ]\n [ 0.03669779 -0.21966671  0.97488451]\n [-0.10362895  0.49375687  0.86340326]\n [-0.8408654  -0.5135838   0.17081292]\n [-0.81009123  0.37987022  0.44659917]\n [-0.69068581  0.19345683  0.69679808]\n [-0.31272303 -0.34695196  0.88421075]\n [ 0.35300635 -0.66098507  0.66218219]\n [ 0.99363148  0.00729362  0.11244239]\n [ 0.52247988  0.72851389  0.44303756]\n [ 0.85807031 -0.02918715  0.5127021 ]\n [-0.10684707  0.95597749  0.27329605]\n [-0.08647343 -0.54092124  0.83661613]\n [ 0.5510663   0.50567611  0.66379033]\n [ 0.21428202  0.83939382  0.49950099]\n [ 0.21372546 -0.46400794  0.8596616 ]\n [ 0.84321252 -0.52227536  0.12736205]\n [-0.85972589 -0.29003618  0.42041694]\n [-0.50672214 -0.01651831  0.86195117]\n [-0.38505783  0.29286812  0.87519068]\n [-0.63196618 -0.76309358  0.13530312]\n [ 0.5407156  -0.82543672  0.16211372]\n [ 0.26638849 -0.9613867   0.06908539]\n [-0.59806911  0.6892814   0.40890647]\n [-0.96868622  0.22784374  0.09866226]\n [-0.33992264 -0.93389323  0.11088749]\n [ 0.76190618 -0.30103266  0.57347913]\n [-0.67816543  0.73063746  0.07912372]\n [ 0.50480845 -0.7455739   0.43507239]\n [-0.46054055 -0.79555927  0.39368497]\n [-0.12400492 -0.92299719  0.36427868]\n [ 0.22510718  0.06418008  0.97221791]\n [ 0.20641097 -0.90425752  0.37378182]\n [-0.60151254 -0.31767314  0.73298461]\n [-0.02649738  0.74745553  0.66378318]\n [ 0.74219636  0.65479978  0.14276492]\n [-0.28107091  0.82747339  0.48609354]\n [ 0.38166642 -0.18887159  0.90479736]\n [ 0.27396087  0.62529452  0.73072034]\n [ 0.72933698 -0.55231693  0.4037494 ]\n [-0.91454636  0.08554178  0.39533221]\n [-0.2293508  -0.74992219  0.6204957 ]\n [ 0.4754902   0.23790446  0.84694187]\n [ 0.48226551  0.8597359   0.16814924]\n [ 0.77169039  0.49362836  0.4010299 ]\n [ 0.91554673  0.21194055  0.34184117]\n [-0.7701603  -0.09150318  0.63125295]\n [-0.84451987  0.50221104  0.18593078]\n [-0.4654141  -0.57711311  0.67106644]\n [-0.07051484  0.19419914  0.97842442]\n [ 0.73214378  0.24406014  0.63592463]\n [-0.34081309  0.62007051  0.70665338]\n [-0.22612641 -0.05725387  0.97241392]\n [ 0.18986916  0.95549755  0.22577452]\n [ 0.92751189  0.36585046  0.07664942]\n [ 0.5401859  -0.41993756  0.72928159]\n [-0.58804797  0.4773355   0.65295513]\n [ 0.19614519  0.38822601  0.90044857]\n [ 0.62579607 -0.04787021  0.77851636]\n [ 0.92907407 -0.25474532  0.26819061]\n [-0.6961131  -0.55781155  0.45196552]\n [ 0.0728861  -0.76981131  0.63409634]\n [-0.97484953 -0.14227137  0.17154371]\n [-0.03030616 -0.99786452  0.05786142]\n [-0.42317947  0.88451485  0.1963482 ]\n [ 0.03669779 -0.21966671  0.97488451]\n [-0.10362895  0.49375687  0.86340326]\n [-0.8408654  -0.5135838   0.17081292]\n [-0.81009123  0.37987022  0.44659917]\n [-0.69068581  0.19345683  0.69679808]\n [-0.31272303 -0.34695196  0.88421075]\n [ 0.35300635 -0.66098507  0.66218219]\n [ 0.99363148  0.00729362  0.11244239]\n [ 0.52247988  0.72851389  0.44303756]\n [ 0.85807031 -0.02918715  0.5127021 ]\n [-0.10684707  0.95597749  0.27329605]\n [-0.08647343 -0.54092124  0.83661613]\n [ 0.5510663   0.50567611  0.66379033]\n [ 0.21428202  0.83939382  0.49950099]\n [ 0.21372546 -0.46400794  0.8596616 ]\n [ 0.84321252 -0.52227536  0.12736205]\n [-0.85972589 -0.29003618  0.42041694]\n [-0.50672214 -0.01651831  0.86195117]\n [-0.38505783  0.29286812  0.87519068]\n [-0.63196618 -0.76309358  0.13530312]\n [ 0.5407156  -0.82543672  0.16211372]\n [ 0.26638849 -0.9613867   0.06908539]\n [-0.59806911  0.6892814   0.40890647]\n [-0.96868622  0.22784374  0.09866226]\n [-0.33992264 -0.93389323  0.11088749]\n [ 0.76190618 -0.30103266  0.57347913]\n [-0.67816543  0.73063746  0.07912372]\n [ 0.50480845 -0.7455739   0.43507239]\n [-0.46054055 -0.79555927  0.39368497]\n [-0.12400492 -0.92299719  0.36427868]\n [ 0.22510718  0.06418008  0.97221791]\n [ 0.20641097 -0.90425752  0.37378182]\n [-0.60151254 -0.31767314  0.73298461]\n [-0.02649738  0.74745553  0.66378318]\n [ 0.74219636  0.65479978  0.14276492]\n [-0.28107091  0.82747339  0.48609354]\n [ 0.38166642 -0.18887159  0.90479736]\n [ 0.27396087  0.62529452  0.73072034]\n [ 0.72933698 -0.55231693  0.4037494 ]\n [-0.91454636  0.08554178  0.39533221]\n [-0.2293508  -0.74992219  0.6204957 ]\n [ 0.4754902   0.23790446  0.84694187]\n [ 0.          0.          0.        ]]\n</pre></div>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[[</span> <span class=\"mf\">0.</span>          <span class=\"mf\">0.</span>          <span class=\"mf\">0.</span>        <span class=\"p\">]</span>\n <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.80451777</span> <span class=\"o\">-</span><span class=\"mf\">0.16877559</span>  <span class=\"mf\">0.56944355</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.32822557</span> <span class=\"o\">-</span><span class=\"mf\">0.94355999</span>  <span class=\"mf\">0.04430036</span><span class=\"p\">]</span>\n <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.23584135</span> <span class=\"o\">-</span><span class=\"mf\">0.96241331</span>  <span class=\"mf\">0.13468285</span><span class=\"p\">]</span>\n <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.39207424</span> <span class=\"o\">-</span><span class=\"mf\">0.73505312</span>  <span class=\"mf\">0.55314981</span><span class=\"p\">]</span>\n <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.32539386</span> <span class=\"o\">-</span><span class=\"mf\">0.16751384</span>  <span class=\"mf\">0.93062235</span><span class=\"p\">]</span>\n <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.82043195</span> <span class=\"o\">-</span><span class=\"mf\">0.39411534</span>  <span class=\"mf\">0.41420347</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.65741493</span>  <span class=\"mf\">0.74947875</span>  <span class=\"mf\">0.07802061</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.88853765</span>  <span class=\"mf\">0.45303621</span>  <span class=\"mf\">0.07251925</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.39638642</span> <span class=\"o\">-</span><span class=\"mf\">0.15185138</span>  <span class=\"mf\">0.90543855</span><span class=\"p\">]</span>\n                 <span class=\"o\">...</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.10175269</span>  <span class=\"mf\">0.08197111</span>  <span class=\"mf\">0.99142681</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.50577702</span> <span class=\"o\">-</span><span class=\"mf\">0.37862345</span>  <span class=\"mf\">0.77513476</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.42845026</span>  <span class=\"mf\">0.40155296</span>  <span class=\"mf\">0.80943535</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.26939707</span>  <span class=\"mf\">0.81103868</span>  <span class=\"mf\">0.51927014</span><span class=\"p\">]</span>\n <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.48938584</span> <span class=\"o\">-</span><span class=\"mf\">0.43780086</span>  <span class=\"mf\">0.75420946</span><span class=\"p\">]</span>\n <span class=\"p\">[</span> <span class=\"mf\">0.</span>          <span class=\"mf\">0.</span>          <span class=\"mf\">0.</span>        <span class=\"p\">]]</span>\n</pre></div>\n</div>\n<p>Both b-values and b-vectors look correct. Let\u2019s now create the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">GradientTable</span></code>.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">gtab</span> <span class=\"o\">=</span> <span class=\"n\">gradient_table</span><span class=\"p\">(</span><span class=\"n\">bvals</span><span class=\"p\">,</span> <span class=\"n\">bvecs</span><span class=\"p\">)</span>\n\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">clear</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>We can also visualize the gradients. Let\u2019s color the first shell blue and\nthe second shell cyan.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">colors_b1000</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">colors</span><span class=\"o\">.</span><span class=\"n\">blue</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ones</span><span class=\"p\">(</span><span class=\"n\">vertices</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n<span class=\"n\">colors_b2500</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">colors</span><span class=\"o\">.</span><span class=\"n\">cyan</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ones</span><span class=\"p\">(</span><span class=\"n\">vertices</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n<span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">vstack</span><span class=\"p\">((</span><span class=\"n\">colors_b1000</span><span class=\"p\">,</span> <span class=\"n\">colors_b2500</span><span class=\"p\">))</span>\n<span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">insert</span><span class=\"p\">(</span><span class=\"n\">colors</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">([</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ascontiguousarray</span><span class=\"p\">(</span><span class=\"n\">colors</span><span class=\"p\">)</span>\n\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">point</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"o\">.</span><span class=\"n\">gradients</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"p\">,</span> <span class=\"n\">point_radius</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">))</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as gradients.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;gradients.png&#39;</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_gradients_spheres_003.png\" srcset=\"../../_images/sphx_glr_gradients_spheres_003.png\" alt=\"gradients spheres\" class = \"sphx-glr-single-img\"/><div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Saving illustration as gradients.png\n</pre></div>\n</div>\n<figure class=\"align-center\" id=\"id4\">\n<img alt=\"examples_built/04_preprocessing/gradients.png\" src=\"examples_built/04_preprocessing/gradients.png\" />\n<figcaption>\n<p><span class=\"caption-text\">Diffusion gradients.</span><a class=\"headerlink\" href=\"#id4\" title=\"Permalink to this image\">\u00b6</a></p>\n</figcaption>\n</figure>\n<section id=\"references\">\n<h2>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<div role=\"list\" class=\"citation-list\">\n<div class=\"citation\" id=\"jones1999\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id1\">Jones1999</a><span class=\"fn-bracket\">]</span></span>\n<p>Jones, DK. et al. Optimal strategies for measuring diffusion in\nanisotropic systems by magnetic resonance imaging, Magnetic Resonance in\nMedicine, vol 42, no 3, 515-525, 1999.</p>\n</div>\n</div>\n<p class=\"sphx-glr-timing\"><strong>Total running time of the script:</strong> ( 0 minutes  2.568 seconds)</p>\n<div class=\"sphx-glr-footer sphx-glr-footer-example docutils container\" id=\"sphx-glr-download-examples-built-04-preprocessing-gradients-spheres-py\">\n<div class=\"sphx-glr-download sphx-glr-download-python docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/2bbbe08ffabbe89f7b55ab6380828a5d/gradients_spheres.py\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Python</span> <span class=\"pre\">source</span> <span class=\"pre\">code:</span> <span class=\"pre\">gradients_spheres.py</span></code></a></p>\n</div>\n<div class=\"sphx-glr-download sphx-glr-download-jupyter docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/88ac0aecef436ce391499d65dcc112b8/gradients_spheres.ipynb\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Jupyter</span> <span class=\"pre\">notebook:</span> <span class=\"pre\">gradients_spheres.ipynb</span></code></a></p>\n</div>\n</div>\n<p class=\"sphx-glr-signature\"><a class=\"reference external\" href=\"https://sphinx-gallery.github.io\">Gallery generated by Sphinx-Gallery</a></p>\n</section>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["examples_built/04_preprocessing/denoise_ascm", "Denoise images using Adaptive Soft Coefficient Matching (ASCM)", "N", "next"], ["examples_built/04_preprocessing/denoise_localpca", "Denoise images using Local PCA via empirical thresholds", "P", "previous"]], "sourcename": "examples_built/04_preprocessing/gradients_spheres.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Gradients and Spheres</a><ul>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "examples_built/04_preprocessing/gradients_spheres", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}