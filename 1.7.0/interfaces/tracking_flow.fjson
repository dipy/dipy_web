{"parents": [{"link": "../../documentation/", "title": "Documentation"}, {"link": "../", "title": "DIPY Workflows Interfaces"}], "prev": {"link": "../reconstruction_flow/", "title": "Reconstruction"}, "next": {"link": "../buan_flow/", "title": "BUndle ANalytics (BUAN) framework"}, "title": "Tracking", "meta": {}, "body": "<section id=\"tracking\">\n<span id=\"tracking-flow\"></span><h1>Tracking<a class=\"headerlink\" href=\"#tracking\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p>This tutorial walks through the steps to perform fiber tracking using DIPY.\nMultiple tracking methods are available in DIPY.</p>\n<p>You can try these methods using your own data; we will be using the data in\nDIPY. You can check how to <a class=\"reference internal\" href=\"../data_fetch/#data-fetch\"><span class=\"std std-ref\">fetch the DIPY data</span></a>.</p>\n<section id=\"local-fiber-tracking\">\n<h2>Local Fiber Tracking<a class=\"headerlink\" href=\"#local-fiber-tracking\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>Local fiber tracking is an approach used to model white matter fibers by\ncreating streamlines from local directional information. The idea is as follows:\nif the local directionality of a tract/pathway segment is known, one can\nintegrate along those directions to build a complete representation of that\nstructure. Local fiber tracking is widely used in the field of diffusion MRI\nbecause it is simple and robust.</p>\n<p>In order to perform local fiber tracking, three things are needed:</p>\n<ol class=\"arabic simple\">\n<li><p>A method for getting directions from a diffusion data set.</p></li>\n<li><p>A method for identifying when the tracking must stop.</p></li>\n<li><p>A set of seeds from which to begin tracking.</p></li>\n</ol>\n<p>We will be using the <code class=\"docutils literal notranslate\"><span class=\"pre\">stanford_hardi</span></code> dataset for the local tracking command\nline interface demonstration purposes.</p>\n<p>We will start by creating the directory to which to save the stopping file\n(e.g.: <code class=\"docutils literal notranslate\"><span class=\"pre\">stop_file</span></code>):</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">stop_file</span>\n</pre></div>\n</div>\n<p>The workflow for each local tracking method requires the paths to the peaks and\nmetrics files, stopping files, and seeding files. The default value for the\nlocal tracking method to be used (specified through the <code class=\"docutils literal notranslate\"><span class=\"pre\">tracking_method</span></code>\nparameter) is <code class=\"docutils literal notranslate\"><span class=\"pre\">eudx</span></code> (EuDX tracking <a class=\"reference internal\" href=\"../../examples_built/23_segmentation/segment_quickbundles/#garyfallidis12\" id=\"id1\"><span>[Garyfallidis12]</span></a>). A number of optional\narguments, such as the number of seeds per dimension within a voxel\n(<code class=\"docutils literal notranslate\"><span class=\"pre\">seed_density</span></code>), or the output directory (<code class=\"docutils literal notranslate\"><span class=\"pre\">out_dir</span></code>), can also be provided.</p>\n<p>To get the stopping file, we will create a binary file of the GFA of the CSA\nreconstruction method and set a stopping criterion by calling the <code class=\"docutils literal notranslate\"><span class=\"pre\">dipy_mask</span></code>\ncommand:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_mask</span> <span class=\"n\">recons</span><span class=\"o\">-</span><span class=\"n\">csa</span><span class=\"o\">/</span><span class=\"n\">gfa</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"mf\">0.25</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;stop_file&quot;</span>\n</pre></div>\n</div>\n<p>We will use the white matter (WM) partial volume effects (PVE) map corresponding\nto the diffusion data being tracked, and available through the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">stanford_pve_maps</span></code> dataset, as the seeding file (e.g.: <code class=\"docutils literal notranslate\"><span class=\"pre\">pve_wm.nii.gz</span></code>).</p>\n<p>There are four tracking methods as described below.</p>\n<section id=\"eudx-tracking\">\n<h3>EuDX Tracking<a class=\"headerlink\" href=\"#eudx-tracking\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>We will first create the directory in which to save the output tractogram file\n(e.g.: <code class=\"docutils literal notranslate\"><span class=\"pre\">eudx_tracking_output</span></code>):</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">eudx_tracking_output</span>\n</pre></div>\n</div>\n<p>Then, to perform the EuDX tracking we will run the <code class=\"docutils literal notranslate\"><span class=\"pre\">dipy_track</span></code> command as:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_track</span> <span class=\"n\">recons</span><span class=\"o\">-</span><span class=\"n\">csa</span><span class=\"o\">/</span><span class=\"n\">peaks</span><span class=\"o\">.</span><span class=\"n\">pam5</span> <span class=\"n\">stop_file</span><span class=\"o\">/</span><span class=\"n\">mask</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_wm</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;eudx_tracking_output&quot;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"deterministic-tracking\">\n<h3>Deterministic Tracking<a class=\"headerlink\" href=\"#deterministic-tracking\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Deterministic maximum direction getter is the deterministic version of the\nprobabilistic direction getter. It can be used with the same local models and\nhas the same parameters. Deterministic maximum fiber tracking follows the\ntrajectory of the most probable pathway within the tracking constraint (e.g.\nmax angle). In other words, it follows the direction with the highest\nprobability from a distribution, as opposed to the probabilistic direction\ngetter which draws the direction from the distribution. Therefore, the maximum\ndeterministic direction getter is equivalent to the probabilistic direction\ngetter returning always the maximum value of the distribution.</p>\n<p>Deterministic maximum fiber tracking is an alternative to EuDX deterministic\ntractography, and unlike EuDX, it does not follow the peaks of the local models,\nbut uses the entire orientation distributions.</p>\n<p>We will first create the directory in which to save the output tractogram file\n(e.g.: <code class=\"docutils literal notranslate\"><span class=\"pre\">det_tracking_output</span></code>):</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">det_tracking_output</span>\n</pre></div>\n</div>\n<p>Then, to perform the deterministic tracking we will run the <code class=\"docutils literal notranslate\"><span class=\"pre\">dipy_track</span></code>\ncommand as:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_track</span> <span class=\"n\">recons</span><span class=\"o\">-</span><span class=\"n\">csa</span><span class=\"o\">/</span><span class=\"n\">peaks</span><span class=\"o\">.</span><span class=\"n\">pam5</span> <span class=\"n\">stop_file</span><span class=\"o\">/</span><span class=\"n\">mask</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_wm</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"o\">--</span><span class=\"n\">seed_density</span> <span class=\"mi\">2</span> <span class=\"o\">--</span><span class=\"n\">tracking_method</span> <span class=\"s2\">&quot;det&quot;</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;det_tracking_output&quot;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"probabilistic-tracking\">\n<h3>Probabilistic Tracking<a class=\"headerlink\" href=\"#probabilistic-tracking\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Probabilistic fiber tracking is a way of reconstructing white matter connections\nusing diffusion MR imaging. Like deterministic fiber tracking, the probabilistic\napproach follows the trajectory of a possible pathway step by step starting at a\nseed; however, unlike deterministic tracking, the tracking direction at each\npoint along the path is chosen at random from a distribution. The distribution\nat each point is different and depends on the observed diffusion data at that\npoint. The distribution of tracking directions at each point can be represented\nas a probability mass function (PMF) if the possible tracking directions are\nrestricted to discrete numbers of well distributed points on a sphere.</p>\n<p>We will first create the directory in which to save the output tractogram file\n(e.g.: <code class=\"docutils literal notranslate\"><span class=\"pre\">prob_tracking_output</span></code>):</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">prob_tracking_output</span>\n</pre></div>\n</div>\n<p>Then, to perform the probabilistic tracking we will run the <code class=\"docutils literal notranslate\"><span class=\"pre\">dipy_track</span></code>\ncommand as:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_track</span> <span class=\"n\">recons</span><span class=\"o\">-</span><span class=\"n\">csa</span><span class=\"o\">/</span><span class=\"n\">peaks</span><span class=\"o\">.</span><span class=\"n\">pam5</span> <span class=\"n\">stop_file</span><span class=\"o\">/</span><span class=\"n\">mask</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_wm</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"o\">--</span><span class=\"n\">seed_density</span> <span class=\"mi\">2</span> <span class=\"o\">--</span><span class=\"n\">tracking_method</span> <span class=\"s2\">&quot;prob&quot;</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;prob_tracking_output&quot;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"closest-peaks-tracking\">\n<h3>Closest Peaks Tracking<a class=\"headerlink\" href=\"#closest-peaks-tracking\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Closest peaks fiber tracking is a type of deterministic tracking. Deterministic\nstreamlines follow a predictable path through the data by selecting the same\ndiffusion orientation when evaluating the same point through the propagation\nprocess. There may be several estimated directions at each point (such as a\nvoxel center): closest peaks tracking selects one of these estimated directions\non the basis of closeness of match to the previous direction of the streamline.</p>\n<p>We will first create the directory in which to save the output tractogram\nfile (e.g.: <code class=\"docutils literal notranslate\"><span class=\"pre\">closest_peaks_output</span></code>):</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">closest_peaks_output</span>\n</pre></div>\n</div>\n<p>Then, to perform the closest peaks tracking we will run the <code class=\"docutils literal notranslate\"><span class=\"pre\">dipy_track</span></code>\ncommand as:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_track</span> <span class=\"n\">recons</span><span class=\"o\">-</span><span class=\"n\">csa</span><span class=\"o\">/</span><span class=\"n\">peaks</span><span class=\"o\">.</span><span class=\"n\">pam5</span> <span class=\"n\">stop_file</span><span class=\"o\">/</span><span class=\"n\">mask</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_wm</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"o\">--</span><span class=\"n\">seed_density</span> <span class=\"mi\">2</span> <span class=\"o\">--</span><span class=\"n\">tracking_method</span> <span class=\"s2\">&quot;cp&quot;</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;closest_peaks_output&quot;</span>\n</pre></div>\n</div>\n</section>\n</section>\n<section id=\"particle-filtering-tracking-pft\">\n<h2>Particle Filtering Tracking (PFT)<a class=\"headerlink\" href=\"#particle-filtering-tracking-pft\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>Particle Filtering Tracking (PFT) <a class=\"reference internal\" href=\"../../examples_built/13_fiber_tracking/tracking_stopping_criterion/#girard2014\" id=\"id2\"><span>[Girard2014]</span></a> uses tissue partial volume\nestimation (PVE) to reconstruct trajectories connecting the gray matter, and\nnot prematurely stopping in the white matter or in the corticospinal fluid. It\nrelies on a stopping criterion that identifies the tissue where the streamline\nstopped. If the streamline reaches the gray matter, the trajectory is kept. If\nthe streamline incorrectly stopped in the white matter or in the cerebrospinal\nfluid, PFT uses anatomical information to find an alternative streamline\nsegment to extend the trajectory. When this segment is found, the tractography\ncontinues until the streamline reaches the gray matter.</p>\n<p>We will use the <code class=\"docutils literal notranslate\"><span class=\"pre\">stanford_hardi</span></code> dataset in DIPY to showcase this tracking\nmethod. As with any other workflow in DIPY, you can also use your own data!</p>\n<p>We will first create a directory in which to save the output tractogram file\n(e.g.: <code class=\"docutils literal notranslate\"><span class=\"pre\">pft_output</span></code>):</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mkdir</span> <span class=\"n\">pft_output</span>\n</pre></div>\n</div>\n<p>To run the Particle Filtering Tracking method, we need to specify the paths\nto the diffusion input file, white matter partial volume estimate, grey matter\npartial volume estimate, and cerebrospinal fluid partial volume estimate for\ntracking, and seeding file followed by optional arguments. In this case, we\nwill be specifying the threshold for the Probability Mass Function that controls\nthe randomness or probabilistic nature of the tracking (<code class=\"docutils literal notranslate\"><span class=\"pre\">pmf_threshold</span></code>),\nand the output directory (<code class=\"docutils literal notranslate\"><span class=\"pre\">out_dir</span></code>).</p>\n<p>White matter, grey matter, and cerebrospinal fluid volume files are available\nthrough the <code class=\"docutils literal notranslate\"><span class=\"pre\">stanford_pve_maps</span></code> dataset.</p>\n<p>The Particle Filtering Tracking is performed by calling the <code class=\"docutils literal notranslate\"><span class=\"pre\">dipy_track_pft</span></code>\ncommand, e.g.:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dipy_track_pft</span> <span class=\"n\">recons</span><span class=\"o\">-</span><span class=\"n\">csa</span><span class=\"o\">/</span><span class=\"n\">peaks</span><span class=\"o\">.</span><span class=\"n\">pam5</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_wm</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_gm</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_csf</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"n\">data</span><span class=\"o\">/</span><span class=\"n\">stanford_hardi</span><span class=\"o\">/</span><span class=\"n\">pve_wm</span><span class=\"o\">.</span><span class=\"n\">nii</span><span class=\"o\">.</span><span class=\"n\">gz</span> <span class=\"o\">--</span><span class=\"n\">pmf_threshold</span> <span class=\"mf\">0.5</span> <span class=\"o\">--</span><span class=\"n\">out_dir</span> <span class=\"s2\">&quot;pft_output&quot;</span>\n</pre></div>\n</div>\n<p>This command will save the tractogram file to the specified output directory.</p>\n</section>\n<section id=\"overview-of-fiber-tracking-methods\">\n<h2>Overview of Fiber Tracking Methods<a class=\"headerlink\" href=\"#overview-of-fiber-tracking-methods\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<table class=\"docutils align-default\">\n<thead>\n<tr class=\"row-odd\"><th class=\"head\"><p>Fiber Tracking Method</p></th>\n<th class=\"head\"><p>Output</p></th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"row-even\"><td><p>EuDX Tracking</p></td>\n<td><p><img alt=\"image1\" class=\"align-middle\" src=\"https://github.com/dipy/dipy_data/blob/master/eudx_tracking.png?raw=true\" /></p></td>\n</tr>\n<tr class=\"row-odd\"><td><p>Deterministic Tracking</p></td>\n<td><p><img alt=\"image2\" class=\"align-middle\" src=\"https://github.com/dipy/dipy_data/blob/master/deterministic_tracking.png?raw=true\" /></p></td>\n</tr>\n<tr class=\"row-even\"><td><p>Closest Peaks Tracking</p></td>\n<td><p><img alt=\"image3\" class=\"align-middle\" src=\"https://github.com/dipy/dipy_data/blob/master/closest_peaks_tracking.png?raw=true\" /></p></td>\n</tr>\n</tbody>\n</table>\n</section>\n<section id=\"references\">\n<h2>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<div role=\"list\" class=\"citation-list\">\n<div class=\"citation\" id=\"garyfallidis12\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id1\">Garyfallidis12</a><span class=\"fn-bracket\">]</span></span>\n<p>Garyfallidis E., \u201cTowards an accurate brain tractography\u201d,\nPhD thesis, University of Cambridge, 2012.</p>\n</div>\n<div class=\"citation\" id=\"girard2014\" role=\"doc-biblioentry\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id2\">Girard2014</a><span class=\"fn-bracket\">]</span></span>\n<p>Girard, G., Whittingstall, K., Deriche, R., &amp; Descoteaux, M.\nTowards quantitative connectivity analysis: reducing tractography biases.\nNeuroImage, 98, 266-278, 2014.</p>\n</div>\n</div>\n</section>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["interfaces/buan_flow", "BUndle ANalytics (BUAN) framework", "N", "next"], ["interfaces/reconstruction_flow", "Reconstruction", "P", "previous"]], "sourcename": "interfaces/tracking_flow.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Tracking</a><ul>\n<li><a class=\"reference internal\" href=\"#local-fiber-tracking\">Local Fiber Tracking</a><ul>\n<li><a class=\"reference internal\" href=\"#eudx-tracking\">EuDX Tracking</a></li>\n<li><a class=\"reference internal\" href=\"#deterministic-tracking\">Deterministic Tracking</a></li>\n<li><a class=\"reference internal\" href=\"#probabilistic-tracking\">Probabilistic Tracking</a></li>\n<li><a class=\"reference internal\" href=\"#closest-peaks-tracking\">Closest Peaks Tracking</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#particle-filtering-tracking-pft\">Particle Filtering Tracking (PFT)</a></li>\n<li><a class=\"reference internal\" href=\"#overview-of-fiber-tracking-methods\">Overview of Fiber Tracking Methods</a></li>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "interfaces/tracking_flow", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}