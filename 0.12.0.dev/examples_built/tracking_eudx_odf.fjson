{"parents": [], "prev": null, "next": null, "title": "Deterministic Tracking with EuDX on ODF Peaks", "meta": {}, "body": "<div class=\"section\" id=\"deterministic-tracking-with-eudx-on-odf-peaks\">\n<span id=\"example-tracking-eudx-odf\"></span><h1>Deterministic Tracking with EuDX on ODF Peaks<a class=\"headerlink\" href=\"#deterministic-tracking-with-eudx-on-odf-peaks\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">Dipy has updated tools for fiber tracking. Our new machinery for fiber\ntracking is featured in the example titled Introduction to Basic Tracking.\nThe tools demonstrated in this example are no longer actively being\nmaintained and will likely be deprecated at some point.</p>\n</div>\n<p>In this example we do deterministic fiber tracking on fields of ODF peaks. EuDX\n<a class=\"reference internal\" href=\"../../reference/dipy.segment/#id23\" id=\"id1\">[Garyfallidis12]</a> will be used for this.</p>\n<p>This example requires importing example <cite>reconst_csa.py</cite> in order to run. EuDX was\nprimarily made with cpu efficiency in mind. The main idea can be used with any\nmodel that is a child of OdfModel.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">reconst_csa</span> <span class=\"k\">import</span> <span class=\"n\">csapeaks</span><span class=\"p\">,</span> <span class=\"n\">sphere</span>\n</pre></div>\n</div>\n<p>This time we will not use FA as input to EuDX but we will use GFA (generalized FA),\nwhich is more suited for ODF functions. Tracking will stop when GFA is less\nthan 0.2.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">dipy.tracking.eudx</span> <span class=\"k\">import</span> <span class=\"n\">EuDX</span>\n\n<span class=\"n\">eu</span> <span class=\"o\">=</span> <span class=\"n\">EuDX</span><span class=\"p\">(</span><span class=\"n\">csapeaks</span><span class=\"o\">.</span><span class=\"n\">gfa</span><span class=\"p\">,</span>\n          <span class=\"n\">csapeaks</span><span class=\"o\">.</span><span class=\"n\">peak_indices</span><span class=\"p\">[</span><span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">],</span>\n          <span class=\"n\">seeds</span><span class=\"o\">=</span><span class=\"mi\">10000</span><span class=\"p\">,</span>\n          <span class=\"n\">odf_vertices</span><span class=\"o\">=</span><span class=\"n\">sphere</span><span class=\"o\">.</span><span class=\"n\">vertices</span><span class=\"p\">,</span>\n          <span class=\"n\">a_low</span><span class=\"o\">=</span><span class=\"mf\">0.2</span><span class=\"p\">)</span>\n\n<span class=\"n\">csa_streamlines</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">streamline</span> <span class=\"k\">for</span> <span class=\"n\">streamline</span> <span class=\"ow\">in</span> <span class=\"n\">eu</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>Now that we have our streamlines in memory we can save the results on the disk.\nFor this purpose we can use the TrackVis format (<code class=\"docutils literal\"><span class=\"pre\">*.trk</span></code>). First, we need to\ncreate a header.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">nibabel</span> <span class=\"k\">as</span> <span class=\"nn\">nib</span>\n\n<span class=\"n\">hdr</span> <span class=\"o\">=</span> <span class=\"n\">nib</span><span class=\"o\">.</span><span class=\"n\">trackvis</span><span class=\"o\">.</span><span class=\"n\">empty_header</span><span class=\"p\">()</span>\n<span class=\"n\">hdr</span><span class=\"p\">[</span><span class=\"s1\">&#39;voxel_size&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mf\">2.</span><span class=\"p\">,</span> <span class=\"mf\">2.</span><span class=\"p\">,</span> <span class=\"mf\">2.</span><span class=\"p\">)</span>\n<span class=\"n\">hdr</span><span class=\"p\">[</span><span class=\"s1\">&#39;voxel_order&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;LAS&#39;</span>\n<span class=\"n\">hdr</span><span class=\"p\">[</span><span class=\"s1\">&#39;dim&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">csapeaks</span><span class=\"o\">.</span><span class=\"n\">gfa</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[:</span><span class=\"mi\">3</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>Save the streamlines.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">csa_streamlines_trk</span> <span class=\"o\">=</span> <span class=\"p\">((</span><span class=\"n\">sl</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">sl</span> <span class=\"ow\">in</span> <span class=\"n\">csa_streamlines</span><span class=\"p\">)</span>\n\n<span class=\"n\">csa_sl_fname</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;csa_streamline.trk&#39;</span>\n\n<span class=\"n\">nib</span><span class=\"o\">.</span><span class=\"n\">trackvis</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">csa_sl_fname</span><span class=\"p\">,</span> <span class=\"n\">csa_streamlines_trk</span><span class=\"p\">,</span> <span class=\"n\">hdr</span><span class=\"p\">,</span> <span class=\"n\">points_space</span><span class=\"o\">=</span><span class=\"s1\">&#39;voxel&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Visualize the streamlines with fvtk (python vtk is required).</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">dipy.viz</span> <span class=\"k\">import</span> <span class=\"n\">fvtk</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.viz.colormap</span> <span class=\"k\">import</span> <span class=\"n\">line_colors</span>\n\n<span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">ren</span><span class=\"p\">()</span>\n\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">csa_streamlines</span><span class=\"p\">,</span> <span class=\"n\">line_colors</span><span class=\"p\">(</span><span class=\"n\">csa_streamlines</span><span class=\"p\">)))</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as tensor_tracks.png&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;csa_tracking.png&#39;</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id3\">\n<img alt=\"../../_images/csa_tracking.png\" src=\"../../_images/csa_tracking.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Deterministic streamlines with EuDX on ODF peaks field modulated by GFA</strong>.</span></p>\n</div>\n<p>It is also possible to use EuDX with multiple ODF peaks, which is very helpful when\ntracking in crossing areas.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">eu</span> <span class=\"o\">=</span> <span class=\"n\">EuDX</span><span class=\"p\">(</span><span class=\"n\">csapeaks</span><span class=\"o\">.</span><span class=\"n\">peak_values</span><span class=\"p\">,</span>\n          <span class=\"n\">csapeaks</span><span class=\"o\">.</span><span class=\"n\">peak_indices</span><span class=\"p\">,</span>\n          <span class=\"n\">seeds</span><span class=\"o\">=</span><span class=\"mi\">10000</span><span class=\"p\">,</span>\n          <span class=\"n\">odf_vertices</span><span class=\"o\">=</span><span class=\"n\">sphere</span><span class=\"o\">.</span><span class=\"n\">vertices</span><span class=\"p\">,</span>\n          <span class=\"n\">ang_thr</span><span class=\"o\">=</span><span class=\"mf\">20.</span><span class=\"p\">,</span>\n          <span class=\"n\">a_low</span><span class=\"o\">=</span><span class=\"mf\">0.6</span><span class=\"p\">)</span>\n\n<span class=\"n\">csa_streamlines_mult_peaks</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">streamline</span> <span class=\"k\">for</span> <span class=\"n\">streamline</span> <span class=\"ow\">in</span> <span class=\"n\">eu</span><span class=\"p\">]</span>\n\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">clear</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">csa_streamlines_mult_peaks</span><span class=\"p\">,</span> <span class=\"n\">line_colors</span><span class=\"p\">(</span><span class=\"n\">csa_streamlines_mult_peaks</span><span class=\"p\">)))</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as csa_tracking_mpeaks.png&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;csa_tracking_mpeaks.png&#39;</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id4\">\n<img alt=\"../../_images/csa_tracking_mpeaks.png\" src=\"../../_images/csa_tracking_mpeaks.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Deterministic streamlines with EuDX on multiple ODF peaks</strong>.</span></p>\n</div>\n<table class=\"docutils citation\" frame=\"void\" id=\"garyfallidis12\" rules=\"none\">\n<colgroup><col class=\"label\" /><col /></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\"><a class=\"fn-backref\" href=\"#id1\">[Garyfallidis12]</a></td><td>Garyfallidis E., &#8220;Towards an accurate brain tractography&#8221;, PhD thesis, University of Cambridge, 2012.</td></tr>\n</tbody>\n</table>\n<div class=\"admonition-example-source-code admonition\">\n<p class=\"first admonition-title\">Example source code</p>\n<p class=\"last\">You can download <a class=\"reference download internal\" href=\"../../_downloads/tracking_eudx_odf.py\" download=\"\"><code class=\"xref download docutils literal\"><span class=\"pre\">the</span> <span class=\"pre\">full</span> <span class=\"pre\">source</span> <span class=\"pre\">code</span> <span class=\"pre\">of</span> <span class=\"pre\">this</span> <span class=\"pre\">example</span></code></a>.\nThis same script is also included in the dipy source distribution under the\n<code class=\"file docutils literal\"><span class=\"pre\">doc/examples/</span></code> directory.</p>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"]], "sourcename": "examples_built/tracking_eudx_odf.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Deterministic Tracking with EuDX on ODF Peaks</a></li>\n</ul>\n", "display_toc": false, "page_source_suffix": ".rst", "current_page_name": "examples_built/tracking_eudx_odf", "sidebars": null, "customsidebar": null, "alabaster_version": "0.7.10"}